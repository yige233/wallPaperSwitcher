# WallPaperSwitcher

从自定义 URL 加载图像，并设置为壁纸，并且以原生幻灯片形式播放，拥有和正常设置幻灯片壁纸相同的过渡动画。

将壁纸设置为单张图像的话，不论通过哪种方法去切换壁纸，都没有动画，切换过程是生硬的。但幻灯片不会，并且切换幻灯片图像文件夹时，也会有动画，所以可以利用这点，将我们需要的图像提前放在一个文件夹中，然后告诉系统: 我要将这个文件夹作为壁纸相册。然后系统就会播放该文件夹中唯一的一张图片，而且有过渡动画。

那为啥不直接把所有壁纸放进一个文件夹，直接播放该文件夹呢？

这个程序的特别之处在于，它是从 web 获取壁纸而非本地文件夹，也就是说我可以配置好一个随机壁纸 API，本地就不用存储那么多的图片了。我的笔记本也可以使用该 API 获取壁纸，节省笔记本的存储空间。甚至于都不需要壁纸，假设有一个 pixiv 图片 API（）

其实从 web 获取壁纸也不稀奇，主要是没找到过这个功能和幻灯片播放壁纸相结合的工具，就只能想办法手搓了() 其实也不是手搓的，90%(大概)的代码都来源于 Gemini 3 Pro

现在如果壁纸格式允许，并且启用了相应的配置的话，也可以将其设置为锁屏壁纸。

## 使用方法

``` bash
WallpaperSwitcher v1.0.0.0
一款可以从web下载图片，并以幻灯片形式切换壁纸的小程序。切换壁纸将使用原生的过渡动画，并且若其格式被Windows支持，可同时将其设为锁屏壁纸。
用法: WallpaperApp [参数]

参数:
-c, --config [<path>=<value>]      修改配置文件。如果不添加第二个参数，则是打开配置文件。
-j, --jumplist                     为固定到任务栏的快捷方式设置跳转列表，
-q, --quit                         退出正在运行的后台服务。
-h, --help                         显示帮助。
不使用任何参数，即为启动后台服务。若已经存在一个正在运行的后台服务，则执行手动切换壁纸。
```

首次不带参数启动（双击运行）时，会生成一个`config.ini`文件。编辑完成后再次启动，就会根据配置文件启动后台服务了。也可以通过`WS_CONFIG`环境变量指定配置文件路径。

`-j`参数可以为固定到任务栏的快捷方式添加跳转列表，就像右键点击Edge浏览器图标时会看到的“新建窗口”“新建无痕窗口”一样。在终端中执行`WallpaperApp -j`，然后会弹出一个窗口，在任务栏中右键点击该窗口的图标，然后点击“固定到任务栏”即可。右键点击图标就能看到刚刚添加的菜单了。左键单击图标（也就是直接执行）相当于“启动/切换至下一张壁纸”。

另外，直接运行`tool.ps1`，可以打开一个交互式菜单，可以在其中创建\删除自动启动的计划任务。虽然和直接启动没啥差别就是。

建议将系统设置中的“壁纸切换频率”设置为一个大于`IdleThresholdSeconds`的值。
建议关闭统设置中的“扰乱图片顺序”，Windows虽然可以通过符号链接设置壁纸，但设置中的缩略图却可能不能正常生成。

如果不需要自动更换壁纸，可以：

1. 将`IntervalSeconds`设为一个小于10的数字。程序设置完壁纸后就会立即退出。
2. 将`IntervalSeconds`设为一个极大的数字（比如86400，也就是1天）。非常长的更换间隔和不自动更换的效果类似。程序会持续在后台运行，可以响应桌面右键菜单“下一个桌面背景”，和任务栏图标菜单“查看壁纸URL”。

## 配置文件

```ini
[Settings]
# 要存放壁纸的文件夹路径。
BasePath=
# 壁纸图片的URL。
ImageUrl=
# 是否同时将当前壁纸设为锁屏壁纸。
LockScreen=true
# 壁纸切换间隔（秒）。如果小于10，程序将会在设置完壁纸后立即退出。
IntervalSeconds=60
# 用户空闲时间（秒）。超过该时间后，将停止切换壁纸。
IdleThresholdSeconds=600
# 允许作为桌面壁纸的图像格式。支持webp,heic,avif。若包含多个值，使用英文逗号分隔。
ExtraFormat=
# 是否启用日志。
Log=true
# 转换后的图像质量（0-100）。
JPGQuality=95
# 后台准备壁纸失败后，重试的间隔（秒）。
RetryAfter=60
# 当前壁纸使用的槽位。不要自行修改。
CurrentSlot=
```

其中`BasePath`和`ImageUrl`是必填。修改`BasePath`后需要重启服务。其他配置项不需要重启也可以生效。

## 编译

非常简单，执行`build.ps1`即可，不需要安装任何东西。就是通过powershell调用Windows系统上都有的`csc.exe`。从未感到编译如此简单（
